# Troubleshooting Guide

## Backend Issues

### ❌ Error: "database_url Field required"

**Full Error:**
```
pydantic_core._pydantic_core.ValidationError: 1 validation error for Settings
database_url
  Field required [type=missing, input_value={}, input_type=dict]
```

**Causes & Solutions:**

#### **Issue 1: Missing .env File**

**Solution:** Create `.env` file in the **backend** directory

```
E:\AI_recommend\
E:\AI_recommend\backend\.env  ← Create here
E:\AI_recommend\frontend\
```

**Windows PowerShell:**
```powershell
cd E:\AI_recommend\backend
copy .env.example .env
```

**Linux/Mac:**
```bash
cd backend
cp .env.example .env
```

#### **Issue 2: Incomplete Database Connection String**

**❌ Wrong (missing hostname):**
```env
DATABASE_URL=postgresql://user:password/database?sslmode=require
```

**✅ Correct (with hostname):**
```env
DATABASE_URL=postgresql://user:password@ep-hostname-123.region.aws.neon.tech/database?sslmode=require
```

**Notice:** The `@hostname` part between password and database name is **required**!

#### **Issue 3: Get Your Neon.tech Connection String**

1. Go to https://console.neon.tech
2. Select your project
3. Look for **"Connection Details"** or **"Connection string"**
4. Copy the **full** connection string (should include `@ep-...neon.tech`)

**Example of correct Neon.tech connection string:**
```
postgresql://neondb_owner:npg_XXX@ep-cool-mountain-12345.us-east-2.aws.neon.tech/neondb?sslmode=require
```

The format breakdown:
- `neondb_owner` = username
- `npg_XXX` = password
- `@ep-cool-mountain-12345.us-east-2.aws.neon.tech` = **hostname (don't skip this!)**
- `/neondb` = database name
- `?sslmode=require` = connection parameters

#### **Issue 4: Test Your Configuration**

Run this test script to check if your .env file is being read:

```powershell
cd E:\AI_recommend\backend
python test_env.py
```

This will show:
- ✅ If .env file exists
- ✅ If DATABASE_URL is set
- ✅ If hostname is present in connection string
- ❌ What's wrong if it fails

---

## Frontend Issues

### ❌ Error: "Cannot find name 'useRuntimeConfig'" or "Cannot find name '$fetch'"

**Solution:**

1. Install dependencies:
   ```bash
   cd frontend
   npm install
   ```

2. **IMPORTANT:** Generate Nuxt types:
   ```bash
   npm run prepare
   ```

3. Restart your IDE/editor

4. In VS Code: `Ctrl+Shift+P` → "TypeScript: Restart TS Server"

**Why this happens:**
- Nuxt uses auto-imports for composables
- These need to be generated by `npm run prepare`
- The command creates `.nuxt/` directory with TypeScript definitions

---

### ❌ Error: "Module not found" or "Cannot find module"

**Frontend:**
```bash
cd frontend
rm -rf node_modules package-lock.json
npm install
npm run prepare
```

**Backend:**
```bash
cd backend
pip install -r requirements.txt
```

---

## Database Issues

### ❌ Error: "Connection refused" or "Could not connect to database"

**Possible causes:**

#### **1. Neon.tech Database is Paused (Free Tier)**

Neon.tech free tier databases pause after inactivity.

**Solution:**
1. Go to https://console.neon.tech
2. Select your project
3. Click **"Wake up"** or **"Resume"** if the database is paused
4. Wait a few seconds for it to activate
5. Try connecting again

#### **2. Incorrect Connection String**

**Check:**
- Username is correct
- Password is correct (no spaces, special characters encoded)
- Hostname is correct
- Database name is correct
- Using `sslmode=require` parameter

**Test connection:**
```bash
# From Neon.tech dashboard, you can test using their SQL Editor
```

#### **3. Firewall/Network Issues**

**Solution:**
- Check if your firewall allows outbound connections to Neon.tech
- Try from a different network
- Check if you're behind a corporate proxy

---

## API Connection Issues

### ❌ Frontend can't connect to Backend

**Error in browser console:**
```
Failed to fetch
net::ERR_CONNECTION_REFUSED
```

**Solutions:**

#### **1. Backend is not running**

**Check:**
```bash
# Is the backend server running?
# You should see: "Uvicorn running on http://0.0.0.0:8000"
```

**Start backend:**
```bash
cd backend
python main.py
```

#### **2. Wrong API URL**

**Check frontend/.env (if exists) or nuxt.config.ts:**
```typescript
runtimeConfig: {
  public: {
    apiBaseUrl: 'http://localhost:8000'  // Should match backend port
  }
}
```

#### **3. CORS Issues**

If you see CORS errors in browser console:

**Check backend/main.py:**
```python
app.add_middleware(
    CORSMiddleware,
    allow_origins=["*"],  # Should allow your frontend origin
    ...
)
```

---

## Windows-Specific Issues

### ❌ Error: "python: command not found"

**Try:**
```powershell
python3 main.py
# or
py main.py
```

### ❌ .env file not recognized

**Check file extension:**
1. In File Explorer: View → ✅ File name extensions
2. Make sure it's `.env` not `.env.txt`

**Create without extension:**
```powershell
# In PowerShell
New-Item -Path . -Name ".env" -ItemType "file"
```

### ❌ Permission Issues

**Run PowerShell as Administrator:**
1. Right-click PowerShell
2. "Run as Administrator"

---

## General Debugging Tips

### **1. Check All Services are Running**

You need **3 things** running:
- ✅ Neon.tech database (active, not paused)
- ✅ Backend API (http://localhost:8000)
- ✅ Frontend dev server (http://localhost:3000)

### **2. Check Logs**

**Backend logs:**
Look at the terminal where you ran `python main.py`

**Frontend logs:**
- Terminal where you ran `npm run dev`
- Browser console (F12 → Console tab)

### **3. Test Backend Independently**

Visit these URLs in your browser:
- http://localhost:8000 → Should show `{"status":"ok"}`
- http://localhost:8000/docs → Should show API documentation
- http://localhost:8000/api/companies → Should show `[]` or company list

### **4. Clean Install**

**Backend:**
```bash
cd backend
# Create new virtual environment (optional but recommended)
python -m venv venv
venv\Scripts\activate  # Windows
# or
source venv/bin/activate  # Linux/Mac

pip install -r requirements.txt
```

**Frontend:**
```bash
cd frontend
rm -rf node_modules .nuxt package-lock.json
npm install
npm run prepare
```

---

## Still Having Issues?

### **Use the Test Script**

```bash
cd backend
python test_env.py
```

This will diagnose:
- .env file location and contents
- DATABASE_URL format
- Missing hostname in connection string

### **Check Versions**

```bash
# Node.js version (should be 18+)
node --version

# Python version (should be 3.9+)
python --version

# npm version
npm --version
```

### **Common Mistake Checklist**

- [ ] .env file is in **backend** directory (E:\AI_recommend\backend\.env)
- [ ] DATABASE_URL includes **@hostname** part (e.g., `@ep-xxx.neon.tech`)
- [ ] Ran `npm run prepare` after `npm install` in frontend
- [ ] Backend is running on port 8000
- [ ] Frontend is running on port 3000
- [ ] Neon.tech database is active (not paused)
- [ ] Firewall allows connections

---

## Quick Reference

### **Correct Project Structure**

```
E:\AI_recommend\
├── .env.example
├── .gitignore
├── README.md
├── backend\
│   ├── .env               ← Environment variables HERE (in backend folder!)
│   ├── .env.example
│   ├── main.py
│   ├── config.py
│   ├── database.py
│   ├── models.py
│   ├── schemas.py
│   ├── test_env.py        ← Test script
│   └── requirements.txt
└── frontend\
    ├── pages\
    ├── composables\
    ├── app.vue
    ├── nuxt.config.ts
    ├── package.json
    └── tsconfig.json
```

### **Correct .env File Format** (in `backend/.env`)

```env
# Neon Database Configuration
DATABASE_URL=postgresql://neondb_owner:your-password@ep-hostname.region.aws.neon.tech/neondb?sslmode=require

# API Configuration
API_HOST=0.0.0.0
API_PORT=8000
```

---

**Need more help?** Check the README.md and INSTALLATION.md files for detailed setup instructions.
